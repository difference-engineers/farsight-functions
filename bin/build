#!/bin/bash

PROJECT_ID="farsight-239605"
FUNCTION_ID=$1
SHORT_SHA=`git rev-parse --short HEAD`

docker build \
  --cache-from us.gcr.io/$PROJECT_ID/base:latest \
  --tag us.gcr.io/$PROJECT_ID/base:latest \
  --tag us.gcr.io/$PROJECT_ID/base:$SHORT_SHA \
  _base

if [ $FUNCTION_ID ]
  then
  docker build \
    --build-arg PROJECT_ID=$PROJECT_ID \
    --cache-from us.gcr.io/$PROJECT_ID/$FUNCTION_ID:latest \
    --tag us.gcr.io/$PROJECT_ID/$FUNCTION_ID:latest \
    --tag us.gcr.io/$PROJECT_ID/$FUNCTION_ID:$SHORT_SHA \
    $FUNCTION_ID
fi
