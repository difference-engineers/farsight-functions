#!/usr/bin/env ruby

if File.exist?("DRAFT")
  name = File.read("DRAFT").chomp.gsub(/(\W|\.)/, "-")
  exit unless `mkdir #{name}/`
  exit unless `cp -r .template/* #{name}/`
  File.write(File.join(name, "Dockerfile"), File.read(File.join(name, "Dockerfile")).gsub("{{name}}", name))
  File.write("SERVICES", [*File.read("SERVICES").split("\n"), name].join("\n"))
  exit unless `git add SERVICES #{name}/`
  exit unless `git rm DRAFT`
  exit unless `git commit -m 'Finalizing the creation of #{name}'`
  exit unless `git push origin HEAD`
end
